# API Standard: Rest & Resource Design

> Confluence Page ID: 675866738817, Version: 4

**Purpose**
-----------

This section defines how APIs at **Lumen** are structured around resources — the fundamental building blocks of RESTful architecture — ensuring consistency, discoverability, and governance automation across all API domains.

---

**REST Principle — Resource-Centric Design**
--------------------------------------------

### **Governance Objective**

APIs must be modeled around *resources*, not actions.  
A *resource* represents a logical entity (e.g., `customer`, `order`, `connection`) that can be acted upon via standard HTTP methods.

> “The key abstraction of information in REST is a resource.”  
> — *Roy Fielding, REST Dissertation §5.2*

### **Governance Rules**

* Every REST API must identify its **primary resource(s)** before design begins.
* Resources are **nouns**, not verbs.
* CRUD behavior must be represented through **HTTP methods**, not in the URI.

### **✅ Example**

| Not Recommended | Recommended |
| --- | --- |
| `POST /createUser` | `POST /users` |
| `POST /updateUser` | `PATCH /users/{id}` |
| `POST /deleteUser` | `DELETE /users/{id}` |

---

**Resource Hierarchies and URI Scope**
--------------------------------------

### **Governance Objective**

Maintain intuitive, predictable, and domain-contained URI structures.

### **Governance Rules**

* URIs must follow:

  ```
  /{domain}/v{n}/{resource}/{resource_id}/[subresource]
  ```
* Each resource belongs to **one business domain**.
* **No cross-domain fan-out**:  
  A resource in one domain cannot directly reference or nest resources from another.
* URI depth must not exceed **two resource levels** (max 4 path segments after version).

### **✅ Example**

| Allowed | Disallowed |
| --- | --- |
| `/customers/v1/customers/{id}/accounts` | `/projects/{id}/tasks/{taskId}/comments/{commentId}` |
| `/network/v1/connections/{id}` | `/billing/v1/customers/{id}/network/connections` |

---

**Collections vs Singleton Resources**
--------------------------------------

### **Governance Objective**

Differentiate between **collections** (plural) and **singletons** (singular) to ensure consistent structure and expectations.

### **Governance Rules**

* **Collections:** Plural noun, contain multiple resources (e.g., `/customers`).
* **Singletons:** Singular noun, one-per-parent (e.g., `/projects/{id}/config`).
* **Singleton resources must not define:**

  + `id` property
  + `POST` or `DELETE` operations
* **Singletons must define:** `GET` and `PATCH`.

### **Implementation Hint**

Mark singletons explicitly in OAS:

```
x-singleton: true
```

### **✅ Example**

| Type | Path | Allowed Methods |
| --- | --- | --- |
| Collection | `/customers` | `GET`, `POST` |
| Singleton | `/projects/{id}/config` | `GET`, `PATCH` |

---

**Resource Naming**
-------------------

### **Governance Objective**

Enable predictable API navigation and uniform discoverability.

### **Governance Rules**

* Use **nouns** for resources; avoid verbs.
* Pluralize collection names (e.g., `/users`, `/invoices`).
* Singular for singletons (`/me`, `/company`).
* **MUST** use `lowercase kebab-case` (`/service-offers`).
* Resource URIs must always be **URL-safe** and **lowercase**.

---

**Actions on Resources (Non-CRUD)**
-----------------------------------

### **Governance Objective**

Support non-CRUD operations that represent *state transitions* or *processes* without breaking REST uniformity.

### **Governance Rules**

* Use verbs **only** when:

  + The action cannot be represented by standard HTTP methods.
  + It represents a *state transition* or *long-running operation (LRO)*.
* Must be scoped to a resource (not root-level).
* Use **process/job** pattern for asynchronous operations.
* Allowed form:

  ```
  POST /{resource}/{id}/action
  ```

### **✅ Example**

| Not Recommended | Recommended |
| --- | --- |
| `POST /archiveUser` | `POST /users/{id}/archive` |
| `POST /reprovision` | `POST /connections/{id}/reprovision` |

If the operation is long-running, annotate:

```
x-lro: true
```

---

**Resource Identifiers (IDs)**
------------------------------

### **Governance Objective**

Ensure resource identity is secure, unique, stable, and automation-friendly.

### **Governance Rules**

* **MUST be opaque** — consumers should not infer meaning from IDs.
* **MUST be generated by provider**, never client-supplied.
* **MUST be globally unique** within API space.
* **MUST be URL-safe**.
* **MUST use consistent field naming convention**: `<resource>_id`.
* **MUST have fixed length** — changing length constitutes a breaking change.
* **MUST NOT** use sequential IDs.
* **MAY** use UUID v4 or Snowflake-style identifiers.
* **MAY** use short type prefixes (e.g., `PAY_`, `ACC_`) for troubleshooting.

### **Reusable Schema**

```
ResourceId:
  type: string
  description: >
    Opaque, globally unique identifier for a resource.
    Generated by the API provider. Never sequential or client-supplied.
  pattern: '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$'
  example: "279fc665-d04d-4dba-bcad-17c865489dfa"
```

---

**Resource Metadata**
---------------------

### **Governance Objective**

Provide uniform lifecycle visibility (creation, updates) across all resources.

### **Governance Rules**

Every **collection resource** MUST include:

* `id`
* `created_at`
* `last_updated_at`

Singletons exclude these (redundant with parent).

### **Reusable Schema**

```
ResourceMetadata:
  type: object
  required: [id, created_at, last_updated_at]
  properties:
    id:
      $ref: '#/components/schemas/ResourceId'
    created_at:
      type: string
      format: date-time
      description: Creation timestamp (UTC)
    last_updated_at:
      type: string
      format: date-time
      description: Last update timestamp (UTC)
```

---

**Governance Enforcement Rules**
--------------------------------

| Rule ID | Enforcement Type | Description |
| --- | --- | --- |
| `path-domain-scope` | Error | Paths must begin with a domain (e.g., `/billing/`, `/network/`). |
| `path-versioned` | Error | Paths must include major version segment (e.g., `/v1/`). |
| `path-segment-depth` | Error | Maximum path depth = 4 segments after version. |
| `singleton-no-post-delete` | Error | Singleton resources cannot define POST/DELETE. |
| `id-schema-ref` | Error | All `*_id` fields must use `ResourceId` schema. |
| `resource-metadata-required` | Warn | Collection schemas must include `ResourceMetadata`. |
| `verb-endpoint-lro` | Error | Verbs in path allowed only if x-action: true or x-lro: true. This explicitly permits action endpoints for complex state transitions. |

---

**Example Resource Model**
--------------------------

```
paths:
  /customers:
    get:
      summary: List all customers
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/ResourceMetadata'
                        - type: object
                          properties:
                            name:
                              type: string
                              example: "Acme Corp"
    post:
      summary: Create a new customer
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'

  /customers/{customer_id}/accounts:
    get:
      summary: List accounts for a customer
      parameters:
        - name: customer_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ResourceId'
```

---

**Governance Rationale**
------------------------

| Principle | Outcome |
| --- | --- |
| **Resource-centric modeling** | Aligns APIs to REST uniform interface, improving predictability. |
| **Strict URI domain boundaries** | Enables per-domain governance, versioning, and automation. |
| **Opaque, stable identifiers** | Ensures consistency across distributed systems and prevents information leakage. |
| **Singleton control** | Simplifies lifecycle management for dependent configurations. |
| **Action resource governance** | Preserves REST semantics while supporting modern async/LRO workflows. |

---

**Summary**
-----------

This REST & Resource section moves Lumen APIs from loosely interpreted REST conventions to a **governable, automatable, and externally predictable API architecture**.

* Consistent structure = easier discoverability and SDK generation.
* Enforced ID and resource schemas = audit-ready data lineage.
* Governed URI scope = scalable domain modeling without overlap.